<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>B·ªô C·∫•u H√¨nh V·ª£t & C∆∞·ªõc - Qu·∫£n L√Ω</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'primary-dark': '#1e3a8a',
            'secondary-light': '#bfdbfe',
            'accent-orange': '#f97316',
            'accent-green': '#10b981',
          },
          fontFamily: { sans: ['Inter', 'sans-serif'] },
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
    .config-card { transition: all 0.3s ease; }
    .config-card:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); }
    .rating-star { color: #facc15; }
    .tracking-card { border-left: 8px solid #3b82f6; background-color: #eff6ff; }
    .card-header-text { color: white; }
  </style>
</head>
<body class="p-4 sm:p-8">
  <div id="app" class="max-w-7xl mx-auto">
    <header class="text-center mb-10 p-6 bg-white rounded-xl shadow-lg">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-primary-dark tracking-tight">
        B·ªô C·∫•u H√¨nh V·ª£t & C∆∞·ªõc
      </h1>
      <p id="sub-title" class="text-lg text-gray-600 mt-2 italic"></p>
    </header>

    <div id="content">
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-gray-800 border-b-4 border-accent-orange pb-2 mb-6">üéØ Quy T·∫Øc Chung & C√†i ƒê·∫∑t</h2>
        <div id="general-rules" class="bg-white p-6 rounded-xl shadow-md grid grid-cols-1 md:grid-cols-3 gap-4 text-center"></div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold text-gray-800 border-b-4 border-primary-dark pb-2 mb-6">‚úÖ C·∫•u H√¨nh Chu·∫©n (Standard)</h2>
        <div id="standard-configs" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold text-gray-800 border-b-4 border-secondary-light pb-2 mb-6">‚è≥ C·∫•u H√¨nh T·∫°m ƒêang D√πng (Current/Temporary)</h2>
        <div id="current-configs" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold text-gray-800 border-b-4 border-accent-green pb-2 mb-6">üß™ C·∫•u H√¨nh Th·ª≠ Nghi·ªám (Experimental)</h2>
        <div id="experimental-configs" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold text-gray-800 border-b-4 border-primary-dark pb-2 mb-6">‚ö° So S√°nh Nhanh C·∫•u H√¨nh Th·ª≠ Nghi·ªám (Hybrid & ƒê∆°n)</h2>
        <div id="comparison-table" class="overflow-x-auto bg-white rounded-xl shadow-md p-4"></div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold text-blue-700 border-b-4 border-blue-400 pb-2 mb-6">üìä Theo D√µi Qu√° Tr√¨nh</h2>
        <div id="tracking-configs" class="grid grid-cols-1 gap-6"></div>
      </section>

      <div id="error-box" class="hidden p-4 rounded-lg bg-red-50 border border-red-200 text-red-700"></div>
    </div>
  </div>

  <script>
    // ---- UI helpers & constants ----
    const RACKET_COLORS = {
      "Titan 1000 x√°m": { bg: "#1f2937", text: "text-white" }, 
      "Titan 1000 h·ªìng": { bg: "#c026d3", text: "text-white" },
      "Titan 9": { bg: "#991b1b", text: "text-white" },
      "Titan 7": { bg: "#008080", text: "text-white" },
      "Blade 8300": { bg: "#559900", text: "text-white" },
    };
    const DEFAULT_HEADER_COLOR = { bg: '#4b5563', text: 'text-white' };

     function renderStars(score) {
    const maxStars = 5;
    const fullStars = Math.floor(score);
    const halfStar = score - fullStars >= 0.5 ? 1 : 0;
    const emptyStars = maxStars - fullStars - halfStar;
    let starsHTML = "";

    // Sao ƒë·∫ßy
    for (let i = 0; i < fullStars; i++) {
      starsHTML += `<span class="text-orange-600">‚òÖ</span>`;
    }

    // Sao n·ª≠a s√°ng
    if (halfStar === 1) {
      starsHTML += `<span class="text-yellow-400">‚òÖ</span>`;
    }

    // Sao tr·ªëng
    for (let i = 0; i < emptyStars; i++) {
      starsHTML += `<span class="text-gray-300">‚òÖ</span>`;
    }

    return `<span class="tracking-tight">${starsHTML}</span>`;
  }

    function createConfigCard(config) {
    const racketStyle = RACKET_COLORS[config.vot] || DEFAULT_HEADER_COLOR;
    const dg = config.danh_gia || {};
    return `
      <div class="config-card bg-white p-6 rounded-xl shadow-md">
        <div class="p-3 rounded-t-lg -mx-6 -mt-6 mb-4" style="background-color:${racketStyle.bg}">
          <h3 class="text-xl font-extrabold card-header-text">${config.vot}</h3>
        </div>

        <div class="space-y-2">
          <div class="flex justify-between items-center text-md">
            <span class="font-bold text-gray-700">C∆∞·ªõc:</span>
            <span class="font-extrabold text-accent-orange">${config.cuoc}</span>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-gray-500">ƒê∆∞·ªùng k√≠nh:</span>
            <span class="font-medium text-gray-700">${config.duong_kinh || "‚Äî"}</span>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-gray-500">M·ª©c cƒÉng:</span>
            <span class="font-medium text-gray-700">${config.muc_cang || "‚Äî"}</span>
          </div>
        </div>

        <!-- 5 ch·ªâ s·ªë m·ªõi -->
        <div class="mt-4 grid grid-cols-2 gap-2">
          <div class="border rounded-lg p-2">
            <div class="text-xs font-semibold text-gray-500">ATK</div>
            <div class="text-[13px] font-medium text-gray-800">${dg.ATK ?? "‚Äî"}</div>
            <div class="text-sm mt-0.5">${renderStars(dg.ATK ?? 0)}</div>
          </div>
          <div class="border rounded-lg p-2">
            <div class="text-xs font-semibold text-gray-500">Control ‚Ä¢ Net</div>
            <div class="text-[13px] font-medium text-gray-800">${dg.Control_Net ?? (dg.CTRL ?? "‚Äî")}</div>
            <div class="text-sm mt-0.5">${renderStars(dg.Control_Net ?? (dg.CTRL ?? 0))}</div>
          </div>
          <div class="border rounded-lg p-2">
            <div class="text-xs font-semibold text-gray-500">Control ‚Ä¢ Grip</div>
            <div class="text-[13px] font-medium text-gray-800">${dg.Control_Grip ?? (dg.CTRL ?? "‚Äî")}</div>
            <div class="text-sm mt-0.5">${renderStars(dg.Control_Grip ?? (dg.CTRL ?? 0))}</div>
          </div>
          <div class="border rounded-lg p-2">
            <div class="text-xs font-semibold text-gray-500">Comfort</div>
            <div class="text-[13px] font-medium text-gray-800">${dg.Comfort ?? "‚Äî"}</div>
            <div class="text-sm mt-0.5">${renderStars(dg.Comfort ?? 0)}</div>
          </div>
          <div class="border rounded-lg p-2 col-span-2 md:col-span-1">
            <div class="text-xs font-semibold text-gray-500">Durability</div>
            <div class="text-[13px] font-medium text-gray-800">${dg.Durability ?? "‚Äî"}</div>
            <div class="text-sm mt-0.5">${renderStars(dg.Durability ?? 0)}</div>
          </div>
        </div>

        <div class="mt-4">
          <p class="text-sm font-semibold text-gray-700">L·ªëi ch∆°i ph√π h·ª£p:</p>
          <p class="text-xs text-gray-600 mt-1 italic">${config.loi_choi_phu_hop || '‚Äî'}</p>
        </div>

        ${config.ghi_chu ? `
        <div class="mt-3 bg-gray-50 p-2 rounded-lg">
          <p class="text-sm font-semibold text-gray-700">Ghi ch√∫:</p>
          <p class="text-xs text-gray-500 italic">${config.ghi_chu}</p>
        </div>` : ''}

        ${config.thay_the ? `
        <div class="mt-3">
          <p class="text-sm font-semibold text-gray-700">Thay th·∫ø:</p>
          <p class="text-xs text-primary-dark font-medium">${config.thay_the}</p>
        </div>` : ''}
      </div>
    `;
  }

    function createTrackingCard(tracking) {
    const racketStyle = RACKET_COLORS[tracking.vot] || DEFAULT_HEADER_COLOR;
    const c = tracking.nhan_xet_thuc_te || {};
    const dg = tracking.danh_gia_lai || {};
    // Fallback: n·∫øu ch∆∞a c√≥ Control_Net/Grip m·ªõi, d√πng CTRL c≈©
    const ctrlNet  = (dg.Control_Net  ?? dg.CTRL ?? 0);
    const ctrlGrip = (dg.Control_Grip ?? dg.CTRL ?? 0);

    return `
      <div class="tracking-card config-card bg-white p-6 rounded-xl shadow-lg">
        <div class="p-3 rounded-t-lg -mx-6 -mt-6 mb-4" style="background-color:${racketStyle.bg}">
          <h3 class="text-xl font-extrabold card-header-text">üìä ${tracking.vot} - Theo d√µi th·ª±c t·∫ø</h3>
          <p class="text-sm card-header-text mt-1">Ng√†y: ${tracking.ngay}</p>
        </div>

        <div class="space-y-2 mb-4">
          <div class="flex justify-between items-center text-md">
            <span class="font-bold text-gray-700">C∆∞·ªõc:</span>
            <span class="font-extrabold text-accent-orange">${tracking.cuoc}</span>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-gray-500">M·ª©c cƒÉng th·ª±c t·∫ø:</span>
            <span class="font-medium text-gray-700">${tracking.muc_cang_thuc_te || "‚Äî"}</span>
          </div>
          <div class="flex items-center justify-between mt-2 px-3 py-2 bg-blue-50 rounded-lg">
            <span class="text-sm font-semibold text-blue-700">Tr·∫°ng th√°i:</span>
            <span class="text-sm font-bold text-blue-900">${tracking.trang_thai || "‚Äî"}</span>
          </div>
        </div>

        <!-- 5 ch·ªâ s·ªë m·ªõi (ƒë√°nh gi√° l·∫°i) -->
        <div class="grid grid-cols-2 gap-2">
          <div class="border rounded-lg p-2">
            <div class="text-xs font-semibold text-gray-500">ATK (re)</div>
            <div class="text-[13px] font-medium text-gray-800">${dg.ATK ?? "‚Äî"}</div>
            <div class="text-sm mt-0.5">${renderStars(dg.ATK ?? 0)}</div>
          </div>
          <div class="border rounded-lg p-2">
            <div class="text-xs font-semibold text-gray-500">Control ‚Ä¢ Net (re)</div>
            <div class="text-[13px] font-medium text-gray-800">${ctrlNet || "‚Äî"}</div>
            <div class="text-sm mt-0.5">${renderStars(ctrlNet || 0)}</div>
          </div>
          <div class="border rounded-lg p-2">
            <div class="text-xs font-semibold text-gray-500">Control ‚Ä¢ Grip (re)</div>
            <div class="text-[13px] font-medium text-gray-800">${ctrlGrip || "‚Äî"}</div>
            <div class="text-sm mt-0.5">${renderStars(ctrlGrip || 0)}</div>
          </div>
          <div class="border rounded-lg p-2">
            <div class="text-xs font-semibold text-gray-500">Comfort (re)</div>
            <div class="text-[13px] font-medium text-gray-800">${dg.Comfort ?? "‚Äî"}</div>
            <div class="text-sm mt-0.5">${renderStars(dg.Comfort ?? 0)}</div>
          </div>
          <div class="border rounded-lg p-2 col-span-2 md:col-span-1">
            <div class="text-xs font-semibold text-gray-500">Durability (re)</div>
            <div class="text-[13px] font-medium text-gray-800">${dg.Durability ?? "‚Äî"}</div>
            <div class="text-sm mt-0.5">${renderStars(dg.Durability ?? 0)}</div>
          </div>
        </div>

        <div class="mt-4 space-y-3">
          <h4 class="text-sm font-bold text-blue-700">Nh·∫≠n x√©t th·ª±c t·∫ø:</h4>
          ${c.cam_giac_tong_quan ? `<div class="bg-blue-50 p-3 rounded-lg text-xs"><strong class="text-blue-800">C·∫£m gi√°c t·ªïng quan:</strong> ${c.cam_giac_tong_quan}</div>` : ''}
          <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs">
            ${c.be_mat ? `<div class="bg-gray-50 p-2 rounded"><strong class="text-gray-700">B·ªÅ m·∫∑t:</strong> ${c.be_mat}</div>` : ''}
            ${c.smash ? `<div class="bg-gray-50 p-2 rounded"><strong class="text-gray-700">Smash:</strong> ${c.smash}</div>` : ''}
            ${c.bo_nho_sat_luoi ? `<div class="bg-gray-50 p-2 rounded"><strong class="text-gray-700">B·ªè nh·ªè/S√°t l∆∞·ªõi:</strong> ${c.bo_nho_sat_luoi}</div>` : ''}
            ${c.drive ? `<div class="bg-gray-50 p-2 rounded"><strong class="text-gray-700">Drive:</strong> ${c.drive}</div>` : ''}
            ${c.cam_giac ? `<div class="bg-gray-50 p-2 rounded"><strong class="text-gray-700">C·∫£m gi√°c:</strong> ${c.cam_giac}</div>` : ''}
          </div>
          ${c.ket_luan ? `
          <div class="mt-3 p-3 bg-green-50 border-l-4 border-green-500 rounded">
            <p class="text-sm font-semibold text-green-700">K·∫øt lu·∫≠n:</p>
            <p class="text-xs text-green-800 italic mt-1">${c.ket_luan}</p>
          </div>` : ''}
        </div>
      </div>
    `;
  }

    function renderGeneralRules(data) {
      const container = document.getElementById('general-rules');
      const rules = data.quy_tac_chung || {};
      const keys = Object.keys(rules);
      if (!keys.length) {
        container.innerHTML = '<p class="text-gray-500 italic">Ch∆∞a c√≥ quy t·∫Øc.</p>';
        return;
      }
      container.innerHTML = keys.map(key => {
        let title = '';
        switch (key) {
          case 'muc_cang_chuan': title = 'M·ª©c CƒÉng Chu·∫©n'; break;
          case 'muc_cang_tam_thu_nghiem': title = 'CƒÉng T·∫°m/Th·ª≠ Nghi·ªám'; break;
          case 'titan_9_chu·∫©n': title = 'Titan 9 Standard Configs'; break;
          default: title = key.replace(/_/g, ' ');
        }
        return `
          <div class="p-4 bg-secondary-light/50 rounded-lg shadow-inner">
            <p class="text-xs font-semibold uppercase text-primary-dark/80">${title}</p>
            <p class="text-lg font-bold text-gray-800 mt-1">${rules[key]}</p>
          </div>
        `;
      }).join('');
    }

    function renderComparisonTable(data) {
      const container = document.getElementById('comparison-table');
      const rows = data.so_sanh_nhanh_hybrid_va_don;
      if (!rows || rows.length === 0) {
        container.innerHTML = '<p class="text-gray-500 italic">Kh√¥ng c√≥ d·ªØ li·ªáu so s√°nh nhanh.</p>';
        return;
      }
      const columnKeys = Object.keys(rows[0]).filter(k => k !== 'tieu_chi');
      const columnNames = {
        nbg95_exbolt63: 'NBG95/EXBOLT 63',
        bg80_66um: 'BG80/66UM',
        kizuna_z69t: 'Kizuna Z69T',
        yonex_aerobite: 'Aerobite'
      };
      container.innerHTML = `
        <table class="min-w-full divide-y divide-gray-200">
          <thead>
            <tr class="bg-gray-100">
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky left-0 bg-gray-100 w-1/4 rounded-tl-xl">Ti√™u Ch√≠</th>
              ${columnKeys.map(k => `<th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">${columnNames[k] || k.toUpperCase()}</th>`).join('')}
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            ${rows.map(row => `
              <tr>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-primary-dark sticky left-0 bg-white">${row.tieu_chi}</td>
                ${columnKeys.map(k => `<td class="px-6 py-4 whitespace-normal text-sm text-gray-700 text-center">${row[k]}</td>`).join('')}
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    function renderConfigs(list, containerId) {
      const container = document.getElementById(containerId);
      if (!Array.isArray(list) || list.length === 0) {
        container.innerHTML = '<p class="text-gray-500 italic p-4 bg-white rounded-xl">Ch∆∞a c√≥ d·ªØ li·ªáu.</p>';
        return;
      }
      container.innerHTML = list.map(createConfigCard).join('');
    }

    function renderTracking(data) {
      const container = document.getElementById('tracking-configs');
      const list = data.theo_doi_qua_trinh;
      if (!Array.isArray(list) || list.length === 0) {
        container.innerHTML = '<p class="text-gray-500 italic p-4 bg-white rounded-xl">Ch∆∞a c√≥ d·ªØ li·ªáu theo d√µi.</p>';
        return;
      }
      container.innerHTML = list.map(createTrackingCard).join('');
    }

    // ---- Data loading & render ----
    async function loadJSON() {
      // If index.html and badminton_data.json are in the same folder, this relative path is correct.
      const res = await fetch('https://dungraymond.github.io/bmin/badminton_data.json', { cache: 'no-store' });
      if (!res.ok) throw new Error(`HTTP ${res.status} ‚Äî kh√¥ng t·∫£i ƒë∆∞·ª£c badminton_data.json`);
      return res.json();
    }

    function showError(msg) {
      const box = document.getElementById('error-box');
      box.textContent = msg;
      box.classList.remove('hidden');
    }

    async function boot() {
      try {
        const data = await loadJSON();
        document.getElementById('sub-title').textContent = data.tieu_de || '';
        renderGeneralRules(data);
        renderConfigs(data.bo_cau_hinh_chu·∫©n, 'standard-configs');
        renderConfigs(data.bo_cau_hinh_tam_dang_dung, 'current-configs');
        renderConfigs(data.bo_cau_hinh_thu_nghiem, 'experimental-configs');
        renderComparisonTable(data);
        renderTracking(data);
      } catch (err) {
        console.error(err);
        showError('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu: ' + err.message + '. H√£y ki·ªÉm tra t√™n file v√† v·ªã tr√≠ c·ªßa "badminton_data.json".');
      }
    }

    document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html>
